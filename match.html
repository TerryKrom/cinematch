<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinematch</title>
    <link rel="stylesheet" href="./index.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="shortcut icon" href="./popcorn.png" type="image/x-icon">
    <link rel="stylesheet" href="match.css">
    <link rel="stylesheet" href="loading.css">
</head>
    <script defer>
        const userTest = () => {
            testAnimation()
            if(localStorage.getItem('User')){
                console.log('logado')
            let name = localStorage.getItem('User')
            document.getElementById('load-text').innerHTML=`Bem vindo de volta, ${name}`
            }
        }
    </script>
<body>
    <div id="loading" class="pulse">
        <img src="popcorn.png" alt="" width="150">
    </div>
<div class="hidden" id="content">
    <div class="separatorX"></div>
    <header>
            <div class="container-logo">
                <a href="index.html"><img src="./popcorn.png" alt="CineMatch" class="logo">
                </a>
                <h2 id="textlogo">
                    <span style="color: #dc041c">C</span><span>I</span><span>N</span><span>E</span><span style="color: #dc041c">M</span><span>A</span><span>T</span><span>C</span><span>H</span>
                </h2>
            </div>
            <div class="container-links">
                <nav class="nav-links">
                    <ul>
                        <li><a href="index.html">Filmes</a></li>
                        <li><a href="">Recomendações</a></li>
                        <li><a href="">Match</a></li>
                        <li class="btn-login"><a href="./login.html">Login</a></li>
                        <li><a href="">Configurações</a></li>
                    </ul>
                </nav>
                </div>
                <div class="container-perfil">
                    <div class="icon-perfil">
                        <a id="a-perfil" href="./login.html">
                        <img onmouseenter="showOutMenu()" src="./perfil.png" alt="" class="perfil" id="perfil">
                        </a>
                        </div>
                    <div class="menu-perfil"  onmouseleave="removeMenu()">
                        <a id="myaccount" href="account.html">Minha Conta</a>
                        <a href="./login.html" class="out">Sair</a>
                    </div>
                </div>
                <div class="burger" id="burger-menu">
                    <div class="line"></div>
                    <div class="line"></div>
                    <div class="line"></div>
                </div>
    
                <div class="menu-hide">
                    <ul class="hide-li">
                        <li><a href="index.html">Filmes</a></li>
                        <li><a href="">Recomendações</a></li>
                        <li><a href="">Match</a></li>
                        <li class="btn-login"><a href="./login.html">Login</a></li>
                        <li><a href="">Configurações</a></li>
                        <li class="out">Sair</li>
                    </ul>
                  </div>
    
            </header>
    
                <h2 class="m-4 mt-5" id="destaque">CineMatch!
                    <div class="linha"></div>
                </h2>
                
            <section class="mt-5">
                <h2 class="m-4 mt-5">Escolha seus filmes favoritos</h2>
                <div class="main"></div>
            </section>
    <footer>
        <div class="row w-100 justify-content-around align-items-center m-auto b">
            <div class="m-3 col-3 center flex-column">
                <a href="#">Minha Conta</a>
                <a href="#">Logout</a>
                <a href="#">Configurações</a>
            </div>
            <div class="m-3 col-3 center flex-column">
                <a href="#">Filmes</a>
                <a href="#">Recomendações</a>
                <a href="#">Match</a>
            </div>
            <div class="m-3 col-3 col-lg-2 center flex-column">
                <a href="#">Ajuda</a>
                <a href="#">Sobre</a>
                <a href="#">Fale Conosco</a>
            </div>
            
            <p class="col-9 center">Criado por: Guilherme Avila &COPY;</p>
        </div>
    </footer>
</div>
        <script src="./menu.js"></script>
        <script src="loading.js"></script>
        <script type="module">
            
            let imgUrl = localStorage.getItem('UserImg')
            let icon = document.getElementById('perfil')
            let out = document.querySelectorAll('.out')
            let a = document.getElementById('a-perfil')
            if(!localStorage.getItem('User')){
                icon.src='./perfil.png'
                out.forEach(element => {
                    element.style.display='none';
                })
                let btn_a = document.getElementById('myaccount')
                btn_a.innerHTML='Login'
                btn_a.href='./login.html'
            }
            if(localStorage.getItem('User')){
                icon.src=imgUrl
                icon.classList.toggle('logged');
                a.href='account.html'
                out.forEach(element => {
                    element.style.display='flex';
                })
            }
            out.forEach(element => {
                element.addEventListener('click', function(){
                localStorage.clear()
                out.style.display='none';
                window.location.href='http://127.0.0.   1:5500/./login.html'
                })
            })
                
            if(localStorage.length!=0){
                let btns = document.querySelectorAll('.btn-login')
                btns.forEach(element => {
                    element.style.display='none'
                });   
            }
            
        // Importações do Firebase e do Firebase Authentication
         import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
         import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

         
         // Configurações do Firebase
         const firebaseConfig = {
          apiKey: "AIzaSyDpQcKbYfP6PWYo4186zfLKP9vlfZjC5YE",
          authDomain: "cinematch-3e757.firebaseapp.com",
          projectId: "cinematch-3e757",
          storageBucket: "cinematch-3e757.appspot.com",
          messagingSenderId: "372273255417",
          appId: "1:372273255417:web:aea0cdab837d2baaf5e328",
          measurementId: "G-JELQB2MP41"
        };
    
 
         // Inicialização do Firebase
         const app = initializeApp(firebaseConfig);
         const db = getFirestore(app);



         const likedMovies = []
            setTimeout(function(){
                const heart = document.querySelectorAll('.bi-heart-fill');
                let title = document.querySelectorAll('.card-title')
                const title_obj = {}
                title.forEach((item, index) => {
                    title_obj[index] = item
                })
            heart.forEach(element => {
            element.addEventListener("click", function(){
                let id = element.getAttribute('id')
                if(element.classList == 'bi bi-heart-fill liked'){
                    element.style.fill="#fff"
                    element.classList.remove('liked')
                    likedMovies.pop(title_obj[id])
                }else{
                    element.style.fill="#e6051f"
                    element.classList.add('liked')
                    let text_title = title_obj[id].textContent.split('\n', 1)
                    likedMovies.push(text_title[0])
                    addLikedMovieToFirestore(likedMovies)
                }
                })
            })
              
        const addLikedMovieToFirestore = async (movieName) => {
          try {
            const querySnapshot = await getDocs(query(collection(db, "filmes"), where("nome", "==", movieName)));
            if (querySnapshot.empty) {
              // O filme não existe, então podemos adicioná-lo
              await addDoc(collection(db, "filmes"), { nome: movieName });
              console.log("Nome do filme curtido enviado para o Firestore com sucesso!");
            } else {
              // O filme já existe no Firestore
              console.log("O filme já foi curtido anteriormente.");
            }
          } catch (error) {
            console.error("Erro ao verificar/adicionar o filme no Firestore:", error);
          }
        };

        
            },1500)
            </script>
    </body>
</html>
